from tabnanny import check
from base import Base
from pon import Pon
import os
import re
import time
from mtime import Mtime
import pytest


class Test_Check(Pon,Base,Mtime):
    pass

class Test_Check1():
    def setup_class(self): 
        # self.p1 = Test_Check("172.16.160.1","23","admin","admin")
        self.p1 = Test_Check("172.16.110.88","23","admin","admin")
        
        self.p1.tel_main() 
        self.nowtime = self.p1.gettime()

    def test_debugupgrade(self):
        name = self.getfilename()
        a = 1
        list=["gcImage0408.bin","gcImage0530.bin"]
        # list1=["V01.02.00","V01.00.00"]
        
        for i in range (1,1000):
            self.p2 = Test_Check("192.168.1.1","23","user","user123")
            self.p2.tel_debug() 
            name1 = "round%s"%i
            r = i%2
            rel = self.p2.send_cmd("gc_omcicli dbg 7")
            rel = self.p2.send_cmd("gc_omcicli omcilog on")
            rel = self.p2.send_cmd("gccli consoleRedir on")
            self.p2.log(rel,name1,self.nowtime)
            self.p1.tel_deslot(3)
            self.p1.tel_cont()
            self.p1.send_cmd("ont-upgrade")
            rel =self.p1.send_cmd("manual-upgrade 1/6/1 %s GTH904-TW"%(list[r]))
            self.p1.log(rel,name,self.nowtime)
            rel=self.p1.send_cmd("show interface gpon-olt 1/6 ont-upgrade status")
            print(rel)
            rel =re.findall(r"1\s+\S+\s+(\S+)", rel)
            while rel != 'DPOE_NOT_FOUND'and rel != "SUCCESS"and rel !="ACTIVATING":
                rel=self.p1.send_cmd("show interface gpon-olt 1/6 ont-upgrade status")
                self.p1.log(rel,name,self.nowtime)
                rel =re.findall(r"1\s+\S+\s+(\S+)", rel)
                print(rel)
                relx = self.p2.send_cmd("cat /etc/gc_fw_info")
                self.p2.log(relx,name1,self.nowtime)
                time.sleep(10)
            time.sleep(30)
            
            if rel == "DPOE_NOT_FOUND":
                self.p1.log("round%s fail"%(i-a+1),name,self.nowtime)
                break

            else :
                self.p1.log("round %s success"%(a),name,self.nowtime)
                a = a+1

    def test_dechance(self):
        name = self.getfilename()
        a = 1
        list=["gccli bob set 1 0x51 0x81 0x8D 0x01 0x00","gccli bob set 1 0x51 0x81 0x8D 0x01 0x00","gccli bob set 1 0x51 0x81 0xB6 0x01 0x00","gccli bob set 1 0x51 0x81 0xB6 0x01 0x00","gccli bob set 1 0x51 0x81 0xC4 0x01 0x5A","gccli bob set 1 0x51 0x81 0xC4 0x01 0x5A","gccli bob set 1 0x51 0x81 0xC5 0x01 0xDD","gccli bob set 1 0x51 0x81 0xC5 0x01 0xDD",
            "gccli bob set 1 0x51 0x81 0xC6 0x01 0xBC","gccli bob set 1 0x51 0x81 0xC6 0x01 0xBC","gccli bob set 1 0x51 0x81 0xC7 0x01 0xD8","gccli bob set 1 0x51 0x81 0xC7 0x01 0xD8","gccli bob set 1 0x51 0x81 0x8D 0x69 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x94 0x18 0x5F 0x0A 0xF0 0xF0 0xC0 0x8F 0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x19 0x00 0x0F 0xF6 0x0E 0xE1 0x4F 0xF1 0x40 0xA0 0x65 0xB4 0x5A 0xDD 0xBC 0xD8 0x4E 0x20 0x00 0x00 0xDF 0xDF 0x00 0x00 0x3C 0xE4 0xF7 0xFE 0x00 0x14 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xA6 0x80 0xCE 0x80 0x04 0x80 0x1C 0x80 0x00 0x00 0x16 0x30 0x04 0x20 0x4F 0xF0 0x0F 0xF2 0xC8 0x80 0x84 0x00"
            ,"gccli bob set 1 0x51 0x81 0x8D 0x69 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x94 0x18 0x5F 0x0A 0xF0 0xF0 0xC0 0x8F 0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x19 0x00 0x0F 0xF6 0x0E 0xE1 0x4F 0xF1 0x40 0xA0 0x65 0xB4 0x5A 0xDD 0xBC 0xD8 0x4E 0x20 0x00 0x00 0xDF 0xDF 0x00 0x00 0x3C 0xE4 0xF7 0xFE 0x00 0x14 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xA6 0x80 0xCE 0x80 0x04 0x80 0x1C 0x80 0x00 0x00 0x16 0x30 0x04 0x20 0x4F 0xF0 0x0F 0xF2 0xC8 0x80 0x84 0x00","gccli bob set 1 0x51 0x80 0xE9 0x17 0x00 0x2B 0x02 0x00 0x19 0x00 0x29 0x00 0x00 0x00 0x00 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02","gccli bob set 1 0x51 0x80 0xE9 0x17 0x00 0x2B 0x02 0x00 0x19 0x00 0x29 0x00 0x00 0x00 0x00 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x4B 0x00"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x4B 0x00"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x57 0x80"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x57 0x80"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x64 0x00"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x64 0x00"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x70 0x80"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x70 0x80"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x7D 0x00"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x7D 0x00"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x89 0x80"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x89 0x80"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x83 0x40"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x83 0x40"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x6F 0x40"
            ,"gccli bob set 1 0x51 0x80 0xE1 0x02 0x6F 0x40"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ,"gccli bob get 1 0x51 0x81 0xE8 0x02"
            ]
        print(len(list))
        # list1=["V01.02.00","V01.00.00"]
        self.p2 = Test_Check("192.168.1.1","23","user","user123")
        self.p2.tel_debug()
        rel = self.p2.send_cmd("gccli consoleRedir on") 
        self.p2.log(rel,name,self.nowtime)
        for a in range (0,100000):
            i = a%48
            print(i)
            print(type(list[i]))
            relx = self.p2.send_cmd(list[i])
            print(relx)
            self.p2.log(relx,name,self.nowtime)
            rel =re.findall(r"\S+\s+(#)", relx)
            print(rel)
            if rel[0] =="#":
                self.p2.log("roude %s gccli bob success"%(a),name,self.nowtime)
            else:
                self.p2.log("gccli bob fail",name,self.nowtime)
                break
    
    def getfilename(self):
        codename = os.path.basename(__file__)
        return codename 
            
    def teardown(self): 
        self.p1.send_cmd("home")
